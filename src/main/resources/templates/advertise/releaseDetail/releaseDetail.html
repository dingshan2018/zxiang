<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body class="gray-bg">

    <div class="container-div">
    	<div class="col-sm-12 select-info">
      <form id="detail-form">
        <div class="select-list">
          <ul>
            <li>
              <span class="select-item-name">代理商：</span><!-- <input type="text" name="agent"/> -->
              <select
                id="agentId"
                name="agentId"
                data-live-search="true"
                class="block-plugin__select-picker selectpicker"
                data-style="btn-white btn-sm">
                <option value="">全部</option>
              </select>
            </li>
            <li>
              <span class="select-item-name">服务商：</span><!-- <input type="text" name="service"/> -->
              <select
                id="repairId"
                name="repairId"
                data-live-search="true"
                class="block-plugin__select-picker selectpicker"
                data-style="btn-white btn-sm">
                <option value="">全部</option>
              </select>
            </li>
            <li>
              <span class="select-item-name">机主：</span><!-- <input type="text" name="joiner"/> -->
              <select
                id="ownerId"
                name="ownerId"
                data-live-search="true"
                class="block-plugin__select-picker selectpicker"
                data-style="btn-white btn-sm">
                <option value="">全部</option>
              </select>
            </li>
            <li class="select-cascade">
              <span class="select-item-name">省：</span>
              <select
                name="province"
                id="province"
                data-live-search="true"
                class="block-plugin__select-picker selectpicker"
                data-style="btn-white btn-sm">
                <option value="">全部</option>
              </select>
              <span class="select-item-name">市：</span>
              <select
                name="city"
                id="city"
                data-live-search="true"
                class="block-plugin__select-picker selectpicker"
                data-style="btn-white btn-sm">
                <option value="">全部</option>
              </select>
              <span class="select-item-name">区县：</span>
              <select
                name="county"
                id="county"
                data-live-search="true"
                class="block-plugin__select-picker selectpicker"
                data-style="btn-white btn-sm">
              <option value="">全部</option>
            </select>
            </li>
            <li>
              <span class="select-item-name">播放设备：</span>
              <input type="text" name="deviceCode" id="deviceCode"/>
            </li>
            <li>
              <span class="select-item-name">广告名称：</span>
              <input type="text" name="scheduleName" id="scheduleName"/>
            </li>
            <li class="select-time">
              <label>播放时间： </label>
              <input type="text" class="time-input" id="startTime" placeholder="开始时间" name="params[beginTime]"/>
              <span>-</span>
              <input type="text" class="time-input" id="endTime" placeholder="结束时间" name="params[endTime]"/>
            </li>
            <li class="select-btns">
              <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索
              </a>
              <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置
              </a>
            </li>
          </ul>
        </div>
      </form>
    </div>
		<div class="btn-group hidden-xs" id="toolbar" role="group">

		</div>
			
		<div class="col-sm-12 select-table table-striped">
			<table id="bootstrap-table" data-mobile-responsive="true"></table>
		</div>
    </div>
    <div th:include="include :: footer"></div>
    <script th:inline="javascript">
        var editFlag = [[${@permission.hasPermi('settle:releaseDetail:edit')}]];
        var removeFlag = [[${@permission.hasPermi('settle:releaseDetail:remove')}]];
        var prefix = ctx + "advertise/releaseDetail"

        $(function() {
        	//默认绑定省
            proviceBind();
            //绑定事件
            $('#province').change(function () {
              cityBind();
            });

            $('#city').change(function () {
              countyBind();
            });
        	//代理商下拉框数据
            var agentList = selectAgentList();
            $.each(agentList, function (i) {
              $('#agentId').append('<option value=' + agentList[i].agentId + '>' + agentList[i].agentName + '</option>');
            });
            //服务商下拉框数据
            var repairList = selectRepairList();
            $.each(repairList, function (i) {
              $('#repairId').append('<option value=' + repairList[i].repairId + '>' + repairList[i].repairName + '</option>');
            });
            //机主下拉框数据
            var joinList = selectJoinList();
            $.each(joinList, function (i) {
              $('#ownerId').append('<option value=' + joinList[i].joinId + '>' + joinList[i].joinerName + '</option>');
            });
        	
            var options = {
                url: prefix + "/list",
                createUrl: prefix + "/add",
                updateUrl: prefix + "/edit/{id}",
                removeUrl: prefix + "/remove",
                modalName: "广告播放明细",
                columns: [{
		            checkbox: true
		        },
				{
					field : 'releaseDetailId', 
					title : 'ID' ,
					visible : false
				},
				{
					field : 'scheduleId', 
					title : '广告ID' ,
					visible : false
				},
				{
					field : 'deviceCode', 
					title : '播放设备' 
				},
				{
					field : 'scheduleName', 
					title : '广告名称' 
				},
				{
					field : 'deviceId', 
					title : '设备ID' ,
					visible : false
				},
				{
					field : 'terminalId', 
					title : '终端ID' ,
					visible : false
				},
				{
					field : 'address', 
					title : '详细地址' 
				},
				{
					field : 'ownerId', 
					title : '机主ID' ,
					visible : false				
				},
				{
					field : 'ownerName', 
					title : '机主' 
				},
				{
					field : 'repairId', 
					title : '服务商ID' ,
					visible : false
				},
				{
					field : 'repairName', 
					title : '服务商' 
				},
				{
					field : 'agentId', 
					title : '代理商ID',
					visible : false
				},
				{
					field : 'agentName', 
					title : '代理商' 
				},
				{
					field : 'createTime', 
					title : '播放时间' 
				},
		        {
		            title: '操作',
		            align: 'center',
		            formatter: function(value, row, index) {
		            	var actions = [];
		            	actions.push('<a class="btn btn-success btn-xs ' + editFlag + '" href="#" onclick="$.operate.edit(\'' + row.releaseDetailId + '\')"><i class="fa fa-edit"></i>编辑</a> ');
                        actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="#" onclick="$.operate.remove(\'' + row.releaseDetailId + '\')"><i class="fa fa-remove"></i>删除</a>');
						return actions.join('');
		            }
		        }]
            };
            $.table.init(options);
        });
        
      //导出Excel
        function exportExcel(){
        	$.modal.confirm("确认导出？", function() {
        		var agentId = $("#agentId").val();
        		var repairId = $("#repairId").val();
        		var joinId = $("#joinId").val();
        		var startTime = $("#startTime").val();
        		var endTime = $("#endTime").val();
        		var deviceSn = $("#deviceSn").val();
    			var tissueChannel = $("#tissueChannel").val();
    			var createBy = $("#createBy").val();
    			location.href = ctx + "advertise/releaseDetail/excelExport?agentId="+agentId+'&repairId='+repairId+'&joinId='+joinId
    					+'&startTime='+startTime+'&endTime='+endTime+'&deviceSn='+deviceSn+'&tissueChannel='+tissueChannel+'&createBy='+createBy
        		//$.modal.alert("导出成功!");
    		});
        }
      	
      	//搜索查询
        function tissueSearch(){
        	/*var agentId = $("#agentId").val();
    		var repairId = $("#repairId").val();
    		var joinId = $("#joinId").val();
    		var startTime = $("#startTime").val();
    		var endTime = $("#endTime").val();
    		var deviceSn = $("#deviceSn").val();
    		var tissueChannle = $("#tissueChannel").val();
    		var createBy = $("#createBy").val();
    		//var paperSum=document.getElementById("paperSum");
    		//var moneySum=document.getElementById("moneySum");
    		var validPaperSum=document.getElementById("validPaperSum");
    		var invalidPaperSum=document.getElementById("invalidPaperSum");
    		var validMoneySum=document.getElementById("validMoneySum");
        	$.ajax({
    	        url: prefix + "/tissueCount?agentId="+agentId+'&repairId='+repairId+'&joinId='+joinId
    				+'&startTime='+startTime+'&endTime='+endTime+'&deviceSn='+deviceSn+'&tissueChannel='+tissueChannle+'&createBy='+createBy ,
    	        type: "post",
    	        async:false,
    	        success: function (data) {
    	        	//paperSum.innerText=data.paperSum;
    	        	//moneySum.innerText=data.moneySum;
    	        	validPaperSum.innerText=data.validPaperSum;
    	        	invalidPaperSum.innerText=data.invalidPaperSum;
    	        	validMoneySum.innerText=data.validMoneySum;
    	        },
    	        error: function (data) {
    	        	console.log("tissueCount:",data);
    	        	//paperSum.innerText="0";
    	        	//moneySum.innerText="0";
    	        	validPaperSum.innerText="0";
    	        	invalidPaperSum.innerText="0";
    	        	validMoneySum.innerText="0.0";
    	            //alert("后台查询失败");
    	        }
    		})*/
        	$.table.search();
      	}
      	
        function proviceBind () {
            //清空下拉数据
            $('#province').html('');
             var str = "<option value=''>全部</option>";

             var provinceAreaList = selectAreaListByPid("0");
             $.each(provinceAreaList, function (i, item) {
                    str += "<option value=" + item.id + ">" + item.pname + "</option>";
                })
                //将数据添加到省份这个下拉框里面
                $("#province").append(str).selectpicker("refresh");
         }
         function cityBind() {
           var provice = $('#province option:selected').val();
           //判断省份这个下拉框选中的值是否为空
           if (provice == '') {
             return;
           }
           $('#city').html('');
             $("#county").html("<option value=''>全部</option>");
             var str = "<option value=''>全部</option>";

             var cityAreaList = selectAreaListByPid(provice);
             $.each(cityAreaList, function (i, item) {
                    str += "<option value=" + item.id + ">" + item.pname + "</option>";
                })
                //将数据添加到市这个下拉框里面
                $("#city").append(str).selectpicker("refresh");
         }
         function countyBind() {
             var provice = $("#city option:selected").val();
             //判断市这个下拉框选中的值是否为空
             if (provice == "") {
                 return;
             }
             $("#county").html("");
             var str = "<option value=''>全部</option>";

             var countyAreaList = selectAreaListByPid(provice);
             $.each(countyAreaList, function (i, item) {
                    str += "<option value=" + item.id + ">" + item.pname + "</option>";
                })
                //将数据添加到区县这个下拉框里面
                $("#county").append(str).selectpicker("refresh");
         }
    </script>
</body>
</html>