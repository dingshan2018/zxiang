<!DOCTYPE HTML>
<html  lang="zh" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<head th:include="include :: header">
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-adSchedule-audit" th:object="${adSchedule}">
            <div class="form-group">	
                <label class="col-sm-3 control-label"><span style="color: red;">*&nbsp;</span>投放名称：</label>
                <div class="col-sm-8">
                	<input id="adMaterialId" name="adMaterialId" th:field="*{adMaterialId}"  type="hidden">
                    <input id="filename" name="filename" th:field="*{filename}" class="form-control" type="text" readonly="readonly">
                </div>
            </div>

            <div class="form-group">	
                <label class="col-sm-3 control-label"><span style="color: red;">*&nbsp;</span>预览素材：</label>
                <div class="col-sm-8">
                	<!-- <button type="button" class="btn btn-primary" onclick="preview()">&nbsp;预览广告素材</button> -->
                	<!--  <button type="button" class="btn btn-primary" onclick="adView()">&nbsp;广告预览</button>-->
                </div>
            </div>            
            <div class="form-group">	
                <label class="col-sm-3 control-label"><span style="color: red;">*&nbsp;</span>审核结果：</label>
                <div class="col-sm-8">
                	<input type="radio" name="status" value="1" class="radio-box">通过
					<input type="radio" name="status" value="0" class="radio-box">不通过
                </div>
            </div>
            <div class="form-group">	
                <label class="col-sm-3 control-label"><span style="color: red;">*&nbsp;</span>审核意见：</label>
                <div class="col-sm-8">
                	<textarea id="auditOpinion" name="auditOpinion" class="form-control" placeholder="请输入审核意见"></textarea>
                </div>
            </div>
            
			<div class="form-group">
				<div class="form-control-static col-sm-offset-9">
					<button type="submit" class="btn btn-primary">提交</button>
					<button onclick="$.modal.close()" class="btn btn-danger" type="button">关闭</button>
				</div>
			</div>
		</form>
    </div>
    <div th:include="include::footer"></div>
    
    <script type="text/javascript">
		var prefix = ctx + "advertise/adMaterial"
		$("#form-adSchedule-audit").validate({
			rules:{
				filename:{
					required:true,
				},
				status:{
					required:true,
				},
				auditOpinion:{
					required:true,
				},
			},
			submitHandler: function(form) {
				var filename = $("#filename").val();
				var aduitResult = $("input[name='status']:checked").val()=="1"?'通过':'不通过';
				$.modal.confirm("确定对素材 "+ filename + " 审核 " + aduitResult + " ?", function() {
					$.operate.save(prefix + "/auditSave", $('#form-adSchedule-audit').serialize());
		    	});
			}
		});
		
		//预览函数
		function preview(){
			var adScheduleId = $("#adScheduleId").val();
			//var url = ctx + "advertise/adSchedule/preview/" + adScheduleId;
	    	//$.modal.openFull("素材预览", url);
		}
		
		//获取预览文件
		function getPreviewUrl(){
			var previewUrls;
			var adScheduleId = $("#adScheduleId").val();
			$.ajax({
		        url: ctx + "advertise/adMaterial/selectListByAdSchId",
		        type: "post",
		        contentType:"application/json",
		        dataType: "json",
		        data: JSON.stringify({ "adScheduleId": adScheduleId}),
		        async:false,
		        success: function (data) {
		        	previewUrls = data.rows;
		        },
		        error: function (data) {
		        	console.log("getPreviewUrl:",data);
		            alert("查询失败");
		        }
			})
			return previewUrls;
		}
		
		function adView(){
			var http = "http://mmedia.bp.zcloudtechs.cn/mmedia/pageJump/go_programme_view.action?scheduleId=";
			var sxScheduleId = $("#sxScheduleId").val();
			//console.log("http + sxScheduleId:",http + sxScheduleId);
			if(sxScheduleId != '' && sxScheduleId != null){
				var url = http + sxScheduleId;
				window.open(url);
		    	//$.modal.openFull("素材预览", url);
			}else{
				//$.modal.alertWarning("暂未生成排期广告!");
				var url = ctx + "advertise/adSchedule/preview/" + adScheduleId;
		    	$.modal.openFull("素材预览", url);
			}
			
		}
	</script>
</body>
</html>
