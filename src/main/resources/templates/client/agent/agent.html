<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body class="gray-bg">
  <div class="container-div">
    <div class="col-sm-12 select-info">
      <form id="change-form">
        <div class="select-list">
          <ul>
            <li>
              <span class="select-item-name">代理商：</span>
              <input type="text" name="agentName" id="agentName"/>
            </li>
            <li>
              <span class="select-item-name">管理者电话：</span>
              <input type="text" name="managerPhone" id="managerPhone"/>
            </li>
            <li>
              <span class="select-item-name">管理者：</span>
              <input type="text" name="managerName" id="managerName"/>
            </li>
            <li class="select-btns">
              <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索
              </a>
              <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置
              </a>
            </li>
          </ul>
        </div>
      </form>
    </div>
    <div class="btn-group hidden-xs" id="toolbar" role="group">
      <a class="btn btn-outline btn-success btn-rounded" onclick="$.operate.add()" shiro:hasPermission="client:agent:add">
        <i class="fa fa-plus"></i> 新增
      </a>
      <a class="btn btn-outline btn-danger btn-rounded" onclick="$.operate.removeAll()" shiro:hasPermission="client:agent:remove">
        <i class="fa fa-trash-o"></i> 删除
      </a>
      <a class="btn btn-outline btn-info btn-rounded" onclick="salesmanList()" shiro:hasPermission="client:repair:salesman">
        <i class="fa fa-list-ul"></i> 员工管理
      </a>
      <a class="btn btn-outline btn-danger btn-rounded" onclick="fundDetail()" shiro:hasPermission="client:fundLog:list">
        <i class="fa fa-usd"></i> 资金流水
      </a>
    </div>

    <div class="col-sm-12 select-table table-striped">
      <table id="bootstrap-table" data-mobile-responsive="true"></table>
    </div>
  </div>
  <div th:include="include :: footer"></div>
  <script th:inline="javascript">
    var editFlag = [[${@permission.hasPermi('client:agent:edit')}]];
    var removeFlag = [[${@permission.hasPermi('client:agent:remove')}]];
    var editParamFlag = [[${@permission.hasPermi('client:agent:params')}]];
    var depositFlag = [[${@permission.hasPermi('client:withdraw:deposit')}]];
    var prefix = ctx + 'client/agent';

        $(function() {
            var options = {
                url: prefix + "/list",
                createUrl: prefix + "/add",
                updateUrl: prefix + "/edit/{id}",
                editParamUrl: prefix + "/editParam/{id}",
                removeUrl: prefix + "/remove",
                modalName: "代理商",
                striped:true,
                search: false,
                columns: [{
		            checkbox: true
		        },
				{field : 'agentId',title : '代理商ID'},
				{field : 'pagentId',title : '父代理商ID'},
				{field : 'agentName',title : '代理商名称'},
				{field : 'provinceName', title : '代理省份'},
				{field : 'cityName',title : '代理城市'},
				{field : 'countyName',title : '代理地区'},
				{field : 'level',title : '代理等级',formatter: function(value, row, index) {
					if(value == 1) {return "一级代理"}
					if(value == 2) {return "二级代理"}
					return "-";
	            }},
				{field : 'deviceNum',title : '设备数量' },
				{field : 'status',title : '状态',formatter: function(value, row, index) {
					if(value == 0) {return "无效"}
					if(value == 1) {return "有效"}
					return "-";
	            } },
				{field : 'managerName',title : '管理者姓名' },
				{field : 'managerPhone', title : '管理者电话'},
				{field : 'bankReceiver',title : '收款人'},
				{field : 'bankAccount',title : '收款账号'},
				{field : 'bankName',title : '开户行'},
				{field : 'promotorName',title : '直推人' },
				{field : 'adRate',title : '广告收益', visible: false  },
				{field : 'scanRate', title : '扫码收益', visible: false },
				{field : 'promotionRate',title : '推广收益', visible: false },
				{field : 'balance', title : '余额'},
				{field : 'frozenBalance', title : '冻结余额'},
				{field : 'createBy', title : '创建人'},
				{field : 'createTime', title : '创建时间' },
				{field : 'updateBy', title : '更新人'},
				{field : 'updateTime',title : '更新时间'},
		        {title: '操作', align: 'center',
		            formatter: function(value, row, index) {
		            	var actions = [];
		            	actions.push('<a class="btn btn-primary	 btn-xs '+depositFlag+'" href="#" onclick="getMoney(\'' + row.agentId +'\',\''+row.bankAccount+'\',\''+row.bankReceiver +'\',\''+row.bankName + '\')"><i class="glyphicon glyphicon-yen"></i> 提现</a>');
		            	actions.push(' <a class="btn btn-success btn-xs ' + editFlag + '" href="#" onclick="$.operate.edit(\'' + row.agentId + '\')"><i class="fa fa-edit"></i> 编辑</a> ');
//                         actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="#" onclick="$.operate.remove(\'' + row.agentId + '\')"><i class="fa fa-remove"></i> 删除</a>');
                        actions.push(' <a class="btn btn-info btn-xs ' + editParamFlag + '" href="#" onclick="editParam(\'' + row.agentId + '\')"><i class="fa fa-edit"></i> 参数</a>');
                        return actions.join('');
		            }
		        }]
            };
            $.table.init(options);
            $('#bootstrap-table').bootstrapTable('hideColumn', 'agentId');
            $('#bootstrap-table').bootstrapTable('hideColumn', 'pagentId');
            $('#bootstrap-table').bootstrapTable('hideColumn', 'createBy');
            $('#bootstrap-table').bootstrapTable('hideColumn', 'createTime');
            $('#bootstrap-table').bootstrapTable('hideColumn', 'updateBy');
            $('#bootstrap-table').bootstrapTable('hideColumn', 'updateTime');
            $('#bootstrap-table').bootstrapTable('striped','true');
        });
        function editParam(id) {
        	var url = $.table._option.editParamUrl.replace("{id}", id);
        	$.modal.open($.table._option.modalName + "参数配置", url,800,500);
        }
        function salesmanList(cliendId) {
        	var rowsData = $("#bootstrap-table").bootstrapTable('getSelections', function (row) {
        		return row;
	  		});
        	if(rowsData.length == 0 || rowsData.length > 1){
        		$.modal.alertWarning("请选择一条记录");
    			return;
        	}
    		var url = ctx + "client/salesman/03/"+rowsData[0].agentId;
            createMenuItem(url, $.table._option.modalName+'员工管理');
        }
        function fundDetail() {
        	var rowsData = $("#bootstrap-table").bootstrapTable('getSelections', function (row) {
        		return row;
	  		});
        	if(rowsData.length == 0 || rowsData.length > 1){
        		$.modal.alertWarning("请选择一条记录");
    			return;
        	}
    		var url = ctx + "client/fundLog/03/"+rowsData[0].agentId;
            createMenuItem(url, $.table._option.modalName+'资金流水管理');
        }
        function getMoney(clientId,bankAccount,bankReceiver,bankName){
        	if(bankAccount == null || bankAccount == '' || bankAccount == 'null'){
        		$.modal.alertWarning("请填写收款帐号"); return;
        	}
        	if(bankReceiver == null || bankReceiver == '' || bankReceiver == 'null'){
        		$.modal.alertWarning("请填写收款人姓名"); return;
        	}
        	if(bankName == null || bankName == '' || bankName == 'null'){
        		$.modal.alertWarning("请填写开户行"); return;
        	}
        	$.modal.open("提现", ctx +"client/fundLog/getMoney/03/"+clientId, 500, 450);
        }
    </script>
</body>
</html>