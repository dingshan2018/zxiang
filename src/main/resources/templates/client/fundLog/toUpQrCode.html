<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<meta charset="utf-8">
<head th:include="include :: header"></head>
<link href="/ajax/libs/iCheck/custom.css" th:href="@{/ajax/libs/iCheck/custom.css}" rel="stylesheet"/>
<body class="white-bg" style="overflow: hidden;">
	<div class="form-group" style="margin-top: 30px;margin-bottom: 0;margin-left: 15px;">	
		<label class="col-sm-3 control-label" style="width: 120px;text-align: right;">充值金额：</label>
		<input id="money" name="money" class="form-control" type="text" style="display: inline-block;width: auto;"/>
		<button type="submit" class="btn btn-primary" style="margin-left: 21px;" onclick="submitButton()">确定</button>
	</div>
	<div id="qrcode" style="width:220px; height:220px; margin:36px auto 0;"></div>
	<div th:include="include::footer"></div>
<script th:src="@{/js/qrcode.js}"></script>
<script th:inline="javascript">
	var qrcode = new QRCode(document.getElementById("qrcode"), {
		width : 220,
		height : 220
	});
	function makeCode () {		
		var advertiseId = [[${advertiseId}]];
		var url = "http://mp.bp.zcloudtechs.cn/wx/wxpay/dingshanScheduleCode";
		var elText = url+"?order_type=4&advertiseId="+advertiseId+"&total_fee="+$("#money").val();
		qrcode.makeCode(elText);
	}
	function submitButton(){
		var reg = /(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/; 	
		if (!reg.test($("#money").val())) {
			$.modal.alertError("金额输入有误");
			return;
		}
		if ($("#money").val() == '0' || $("#money").val() =='0.0' || $("#money").val() == '0.00') {
			$.modal.alertError("金额需大于0");
			return;
		}
		makeCode();
		$(".btn").prop("disabled","disabled");
		$("#money").prop("disabled","disabled");
	}
	$("#money").on('input  propertychange',function(){
		//如果输入非数字，则替换为''
		this.value = this.value.replace(/[^\d\.]/g, '');
		//必须保证第一个为数字而不是.     
	    this.value = this.value.replace(/^\./g,'');
	    //保证只有出现一个.而没有多个.     
	    this.value = this.value.replace(/\.{2,}/g,'.');
	    //保证.只出现一次，而不能出现两次以上     
	    this.value = this.value.replace('.','$#$').replace(/\./g,'').replace('$#$','.');
	    //只能输入两位小数
	    this.value = this.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3');
	});
</script>
</body>
</html>
