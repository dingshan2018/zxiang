<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--360浏览器优先以webkit内核解析-->
  <title></title>
  <link th:href="@{/css/bootstrap.min.css}"
        rel="stylesheet"/>
  <link th:href="@{/css/bootstrap-datetimepicker.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/font-awesome.css}"
        rel="stylesheet"/>
  <link th:href="@{/css/main/animate.min.css}"
        rel="stylesheet"/>
  <link th:href="@{/css/main/style.min862f.css}"
        rel="stylesheet"/>
  <style>
    ul, li {
      margin: 0;
      padding-left: 0;
      list-style: none;
    }

    body {
      height: auto;
      min-height: 100%;
      padding-bottom: 20px;
    }

    /* background: linear-gradient(to right, rgb(67, 198, 172), rgb(25, 22, 84)) no-repeat left bottom/100% 2px; */

    .block-module-wrapper {
      position: relative;
      padding: 0 35px;
      margin: 0;
      overflow: hidden;
    }

    .block-module-title--tag {
      position: relative;
      padding: 10px 20px;
      margin: 20px 0;
      /* border-left: 5px solid #02c0c8; */
      /* border-left: 5px solid #19aa8d; */
      -webkit-border-radius: 6px;
      -moz-border-radius: 6px;
      border-radius: 6px;
      font-size: 14px;
      background-color: #fff;
      color: #000;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .system-target {
      padding: 10px;
      -webkit-border-radius: 6px;
      -moz-border-radius: 6px;
      border-radius: 6px;
      background-color: #fff;
      overflow: hidden;
    }

    .system-target__list {
      position: relative;
      width: 100%;
      overflow: hidden;
    }

    .system-target__item {
      float: left;
      width: 25%;
      height: 200px;
      padding: 10px;
    }

    .system-target__content {
      position: relative;
      width: 100%;
      height: 100%;
      -webkit-border-radius: 6px;
      -moz-border-radius: 6px;
      border-radius: 6px;
      text-align: center;
      background-color: #fff;
      transition: all .3s linear;
      overflow: hidden;
    }

    .system-target__content:hover {
      -webkit-box-shadow: 2px 2px 16px rgba(0, 0, 0, 0.1);
      box-shadow: 2px 2px 16px rgba(0, 0, 0, 0.1);
      -webkit-transform: translate3d(0, -2px, 0);
      transform: translate3d(0, -2px, 0);
    }

    .system-target__content .target-content__figure {
      display: block;
      width: 60px;
      height: 60px;
      margin: 25px auto 0;
      -webkit-border-radius: 50%;
      -moz-border-radius: 50%;
      border-radius: 50%;
    }

    .system-target__content .target-content__count {
      margin: 10px 0 0 0;
      line-height: 28px;
      height: 28px;
      font-weight: 600;
      font-size: 20px;
    }

    .system-target__content .target-content__name {
      margin-top: 8px;
      font-size: 13px;
      color: #888;
    }

    .paper-echarts-wrapper .chart-panel {
      position: relative;
      width: 100%;
      height: 500px;
      padding-top: 50px;
      -webkit-border-radius: 6px;
      -moz-border-radius: 6px;
      border-radius: 6px;
      background-color: #fff
    }

    .paper-echarts-wrapper .pager-echarts {
      width: 100%;
      height: 100%;
    }

    .paper-echarts-wrapper .chart-date--filter {
      z-index: 10;
      position: absolute;
      top: 42px;
      right: 107px;
      width: 310px;
    }

    .paper-echarts-wrapper .chart-date--filter .chart-date__name {
      float: left;
      vertical-align: middle;
      display: inline-block;
      width: 70px;
      line-height: 34px;
      text-align: right;
    }

    .paper-echarts-wrapper .chart-date--filter .chart-date__time-picker {
      width: 240px;
      border-radius: 3px;
      background-color: #fff;
    }

    .layui-laydate-content td.laydate-selected {
      background-color: #d5e8e6 !important;
    }

  </style>
</head>

<body class="gray-bg">
  <!-- white-bg  border-bottom dashboard-header-->
  <!-- 系统指标 -->
  <div class="block-module-wrapper system-target-wrapper">
    <div class="block-module-title--tag">
      <h4>系统指标</h4>
    </div>
    <div class="system-target">
      <ul class="system-target__list">
        <li class="system-target__item">
          <div class="system-target__content">
            <img th:src="@{/img/icons/main_tissueTotal.png}"
                 class="target-content__figure"/>
            <p class="target-content__count" data-id="tissueTotal"></p>
            <p class="target-content__name">累计出纸量</p>
          </div>
        </li>
        <li class="system-target__item">
          <div class="system-target__content">
            <img th:src="@{/img/icons/main_fansTotal.png}"
                 class="target-content__figure"/>
            <p class="target-content__count" data-id="fansTotal"></p>
            <p class="target-content__name">累计有效出纸量</p>
          </div>
        </li>
        <li class="system-target__item">
          <div class="system-target__content">
            <img th:src="@{/img/icons/main_deviceTotal.png}"
                 class="target-content__figure"/>
            <p class="target-content__count" data-id="deviceTotal"></p>
            <p class="target-content__name">设备总量</p>
          </div>
        </li>
        <li class="system-target__item">
          <div class="system-target__content">
            <img th:src="@{/img/icons/main_agentTotal.png}"
                 class="target-content__figure"/>
            <p class="target-content__count" data-id="agentTotal"></p>
            <p class="target-content__name">代理商总量</p>
          </div>
        </li>
        <li class="system-target__item">
          <div class="system-target__content">
            <img th:src="@{/img/icons/main_fansManTotal.png}"
                 class="target-content__figure"/>
            <p class="target-content__count" data-id="fansManTotal"></p>
            <p class="target-content__name">累计男粉丝</p>
          </div>
        </li>
        <li class="system-target__item">
          <div class="system-target__content">
            <img th:src="@{/img/icons/main_fansWomanTotal.png}"
                 class="target-content__figure"/>
            <p class="target-content__count" data-id="fansWomanTotal"></p>
            <p class="target-content__name">累计女粉丝</p>
          </div>
        </li>
        <li class="system-target__item">
          <div class="system-target__content">
            <img th:src="@{/img/icons/main_fansNotSexTotal.png}"
                 class="target-content__figure"/>
            <p class="target-content__count" data-id="fansNotSexTotal"></p>
            <p class="target-content__name">未知性别</p>
          </div>
        </li>
        <li class="system-target__item">
          <div class="system-target__content">
            <img th:src="@{/img/icons/main_advertiseTotal.png}"
                 class="target-content__figure"/>
            <p class="target-content__count" data-id="advertiseTotal"></p>
            <p class="target-content__name">广告主总量</p>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <!-- 出纸统计 -->
  <div class="block-module-wrapper paper-echarts-wrapper">
    <div class="block-module-title--tag">
      <h4>出纸统计</h4>
    </div>
    <div class="chart-panel">
      <div class="chart-date--filter">
        <span class="chart-date__name">筛选查询：</span>
        <input type="text" class="form-control chart-date__time-picker" readonly/>
      </div>
      <div class="pager-echarts"></div>
    </div>
  </div>

  <script th:src="@{/js/jquery.min.js}"></script>
  <script th:src="@{/js/bootstrap.min.js}"></script>
  <script th:src="@{/js/plugins/echarts/echarts.common.min.js}"></script>
  <script th:src="@{/js/plugins/laydate/laydate.js}"></script>
  <script>

    function systemIndicators () {
      $.post("/home/systemIndicators", function (data) {
        $("[data-id=\"tissueTotal\"]").text(data.tissueTotal);
        $("[data-id=\"fansTotal\"]").text(data.fansTotal);
        $("[data-id=\"deviceTotal\"]").text(data.deviceTotal);
        $("[data-id=\"agentTotal\"]").text(data.agentTotal);
        $("[data-id=\"fansManTotal\"]").text(data.fansManTotal);
        $("[data-id=\"fansWomanTotal\"]").text(data.fansWomanTotal);
        $("[data-id=\"fansNotSexTotal\"]").text(data.fansNotSexTotal);
        $("[data-id=\"advertiseTotal\"]").text(data.advertiseTotal);
      });
    }

    function tissueStatistical (queryDate) {
      $.post("/home/tissueStatistical", {dates: queryDate}, function (data) {
        data = data.dataList;
        var selDate = [];
        var tissueTotal = [];
        var fansManTotal = [];
        var fansWomanTotal = [];
        var fansNotSexTotal = [];

        for (let i = 0; i < data.length; i++) {
          selDate.push(data[i].selDate);
          fansManTotal.push(data[i].fansManTotal);
          fansNotSexTotal.push(data[i].fansNotSexTotal);
          fansWomanTotal.push(data[i].fansWomanTotal);
          tissueTotal.push(data[i].tissueTotal);
        }

        var pagerEchartsOption = {
          color: ["#19aa8d", "#00c1c9", "#e5323e", "#fbdd7e"],
          tooltip: {
            trigger: "axis",
            axisPointer: {
              type: "shadow"
            }
          },
          legend: {
            data: ["单日出纸量", "关注男粉丝", "关注女粉丝", "未知性别"],
            align: "left",
            left: 107
          },
          xAxis: [
            {
              type: "category",
              axisTick: {show: false},
              data: selDate
            }
          ],
          yAxis: [
            {
              type: "value"
            }
          ],
          series: [
            {
              name: "单日出纸量",
              type: "bar",
              data: tissueTotal
            },
            {
              name: "关注男粉丝",
              type: "bar",
              data: fansManTotal
            },
            {
              name: "关注女粉丝",
              type: "bar",
              data: fansWomanTotal
            },
            {
              name: "未知性别",
              type: "bar",
              data: fansNotSexTotal
            }
          ]
        };

        var echart = echarts.init(document.querySelector(".pager-echarts"));
        echart.setOption(pagerEchartsOption);
      });
    }

    Date.prototype.Format = function (format) {
      var o = {
        "M+": this.getMonth() + 1,                   //月份
        "d+": this.getDate(),                        //日
        "h+": this.getHours(),                       //小时
        "m+": this.getMinutes(),                     //分
        "s+": this.getSeconds(),                     //秒
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度
        "S": this.getMilliseconds()                  //毫秒
      };
      if (/(y+)/.test(format))
        format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      for (var k in o)
        if (new RegExp("(" + k + ")").test(format))
          format = format.replace(RegExp.$1,
            (RegExp.$1.length === 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
      return format;
    };

    function initDate () {
      var today = new Date();
      var lastWeek = new Date(today.getTime() - 6 * 24 * 3600 * 1000);

      tissueStatistical(pushQueryDate(lastWeek, today));

      laydate.render({
        elem: ".chart-date__time-picker",
        range: true,
        value: lastWeek.Format("yyyy-MM-dd") + " - " + today.Format("yyyy-MM-dd"),
        max: today.Format("yyyy-MM-dd"),
        done: function (value, startDate, endDate) {
          var dates = value.split(" - ");
          tissueStatistical(pushQueryDate(new Date(dates[0]), new Date(dates[1])));
        }
      });
    }

    function pushQueryDate (startDate, endDate) {
      var queryDate = [];
      var dateDifference = parseInt((endDate.getTime() - startDate.getTime()) / 1000 / 3600 / 24);
      for (var i = dateDifference; i > 0; i--) {
        queryDate.push(new Date(endDate.getTime() - (i * 24 * 3600 * 1000)).Format("yyyy-MM-dd"));
      }
      queryDate.push(endDate.Format("yyyy-MM-dd"));
      return queryDate;
    }

    systemIndicators();
    initDate();
  </script>
</body>
</html>
